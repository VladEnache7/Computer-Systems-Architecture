     1                                  bits 32 
     2                                  
     3                                  
     4                                  global start        
     5                                  
     6                                  
     7                                  extern exit, fopen, fprintf, scanf 
     8                                  ;importing the functions           
     9                                  import exit msvcrt.dll
    10                                  import fopen msvcrt.dll
    11                                  import fprintf msvcrt.dll
    12                                  import scanf msvcrt.dll
    13                                  
    14                                  
    15                                  segment data use32 class=data
    16 00000000 657833305F66696C65-         file_name db "ex30_files.txt", 0;for printing
    16 00000009 732E74787400       
    17 0000000F 7700                        write_mode db "w", 0
    18 00000011 257300                      format_print db "%s", 0
    19 00000014 256300                      format_scan db "%c", 0
    20 00000017 00000000                    descriptor dd 0
    21 0000001B <res 00000001>              c resb 1
    22 0000001C <res 00000064>              string resb 100
    23                                      
    24                                      
    25                                  segment code use32 class=code
    26                                      start:
    27                                          
    28                                          ;fopen(file_name, "a");
    29 00000000 68[0F000000]                    push dword write_mode
    30 00000005 68[00000000]                    push dword file_name
    31 0000000A FF15[00000000]                  call [fopen]
    32 00000010 83C408                          add esp, 4 * 2
    33                                          
    34 00000013 83F800                          cmp eax, 0
    35 00000016 746A                            jz final
    36 00000018 A3[17000000]                    mov [descriptor], eax
    37                                          
    38                                          while_not_$:
    39 0000001D B200                                mov dl, 0           ;digit = False
    40 0000001F BF[1C000000]                        mov edi, string     ; saving
    41 00000024 FC                                  cld                 ;DF = 0
    42                                              while_not_space:    ; reading a word
    43                                                  
    44                                                  
    45                                                  ;scanf("%c", c)
    46 00000025 68[1B000000]                            push dword c
    47 0000002A 68[14000000]                            push dword format_scan
    48 0000002F FF15[00000000]                          call [scanf]
    49                                                  
    50 00000035 803D[1B000000]24                        cmp byte [c], '$'
    51 0000003C 7423                                    je after1
    52                                                  
    53                                                  ;if c is a digit
    54 0000003E 803D[1B000000]30                        cmp byte [c], 48
    55 00000045 720B                                    jb not_digit
    56 00000047 803D[1B000000]39                        cmp byte [c], 57
    57 0000004E 7702                                    ja not_digit    
    58                                              
    59 00000050 B201                                    mov dl, 1       ;digit = True
    60                                                  
    61                                                   
    62                                                  not_digit:
    63 00000052 A0[1B000000]                            mov al, [c]
    64 00000057 AA                                      stosb   ;[edi] = al, inc edi
    65 00000058 803D[1B000000]20                        cmp byte [c],  ' '
    66 0000005F 75C4                                    jnz while_not_space
    67                                              
    68                                              after1
    68          ******************       warning: label alone on a line without a colon might be in error [-w+orphan-labels]
    69 00000061 80FA01                              cmp dl, 1
    70 00000064 C60700                              mov [edi], byte 0
    71 00000067 7519                                jnz not_write
    72                                              
    73                                              ;fprintf(descriptor, "%s", string);
    74 00000069 68[1C000000]                        push dword string
    75 0000006E 68[11000000]                        push dword format_print
    76 00000073 FF35[17000000]                      push dword [descriptor]
    77 00000079 FF15[00000000]                      call [fprintf]
    78 0000007F 83C40C                              add esp, 4 * 3
    79                                              
    80                                              
    81                                              not_write:
    82                                              
    83                                          final:    
    84 00000082 6A00                            push    dword 0     
    85 00000084 FF15[00000000]                  call    [exit]   
