     1                                  bits 32 
     2                                  global start    
     3                                      
     4                                  ;Se citeste de la tastatura un nume de fisier input.txt si un caracter c. Fisierul input.txt contine cuvinte separate prin spatiu. Sa se scrie in fisierul output.txt doar cuvintele in care apare caracterul c citit p
     5                                  
     6                                  ;input.txt: totem pere banane mandarine   c: m     output.txt: totem
     7                                  
     8                                  
     9                                  extern exit, fopen, fscanf, fprintf, scanf, fclose             
    10                                  import exit msvcrt.dll   
    11                                  import fopen msvcrt.dll  
    12                                  import fprintf msvcrt.dll  
    13                                  import scanf msvcrt.dll 
    14                                  import fscanf msvcrt.dll 
    15                                  import fclose msvcrt.dll 
    16                                                            
    17                                  segment data use32 class=data
    18 00000000 <res 00000014>              file_in resb 20
    19 00000014 7200                        read_mode db "r", 0
    20 00000016 <res 00000004>              descriptor1 resd 1
    21                                      
    22 0000001A 6F75747075742E7478-         file_out db "output.txt", 0
    22 00000023 7400               
    23 00000025 7700                        write_mode db "w", 0
    24 00000027 <res 00000004>              descriptor2 resd 1
    25                                      
    26 0000002B 257300                      string_format db "%s", 0
    27 0000002E 256300                      character_format db "%c", 0
    28                                      
    29 00000031 <res 00000004>              c resd 1
    30                                      
    31 00000035 <res 0000001E>              aword resb 30
    32                                  segment code use32 class=code
    33                                      start:
    34                                      
    35                                          ;reading the caracter form the keyboard
    36                                          ;scanf(character_format, &c)
    37 00000000 68[31000000]                    push dword c
    38 00000005 68[2E000000]                    push dword character_format
    39 0000000A FF15[00000000]                  call [scanf]
    40 00000010 83C408                          add esp, 2 * 4
    41                                          
    42                                          ;reading the file name from the user
    43                                          ;scanf(string_format, &file_in);
    44 00000013 68[00000000]                    push dword file_in
    45 00000018 68[2B000000]                    push dword string_format
    46 0000001D FF15[00000000]                  call [scanf]
    47 00000023 83C408                          add esp, 2 * 4
    48                                          
    49                                          
    50                                          
    51                                          ;openning the file for reading
    52                                          ;fopen(file_in, read_mode)
    53 00000026 68[14000000]                    push dword read_mode
    54 0000002B 68[00000000]                    push dword file_in
    55 00000030 FF15[00000000]                  call [fopen]
    56 00000036 83C408                          add esp, 2 * 4
    57 00000039 A3[16000000]                    mov [descriptor1], eax
    58                                          
    59                                          
    60                                          
    61                                          ;openning the file for writing
    62                                          ;fopen(file_out, write_mode)
    63 0000003E 68[25000000]                    push dword write_mode
    64 00000043 68[1A000000]                    push dword file_out
    65 00000048 FF15[00000000]                  call [fopen]
    66 0000004E 83C408                          add esp, 2 * 4
    67 00000051 A3[27000000]                    mov [descriptor2], eax
    68                                          
    69                                          
    70                                          ;reading from the file
    71                                          ;while(fscanf(descriptor1, string_format, aword) != EOF)
    72                                          while_fscanf:
    73                                              ;fscanf(descriptor1, string_format, aword)
    74 00000056 68[35000000]                        push dword aword
    75 0000005B 68[2B000000]                        push dword string_format
    76 00000060 FF35[16000000]                      push dword [descriptor1]
    77 00000066 FF15[00000000]                      call [fscanf]
    78 0000006C 83C40C                              add esp, 3 * 4
    79                                              
    80                                              ;if we finished to read the words
    81 0000006F 83F8FF                              cmp eax, -1
    82 00000072 7433                                je exit_while_fscanf
    83                                              
    84                                              
    85                                              ;going to the last character
    86 00000074 BE[35000000]                        mov esi, aword
    87                                              while_not_space:
    88 00000079 803E00                                  cmp [esi], byte 0
    89 0000007C 7403                                    je space
    90 0000007E 46                                      inc esi
    91 0000007F EBF8                                    jmp while_not_space
    92                                              space:    
    93                                              ;[esi-1] - the last character
    94 00000081 8B46FF                              mov eax, [esi - 1]
    95 00000084 3B05[31000000]                      cmp eax, [c]
    96 0000008A 7519                                jne not_printing
    97                                              
    98                                              ;printing
    99                                              ;fprintf(descriptor2, string_format, aword)
   100 0000008C 68[35000000]                        push dword aword
   101 00000091 68[2B000000]                        push dword string_format
   102 00000096 FF35[27000000]                      push dword [descriptor2]
   103 0000009C FF15[00000000]                      call [fprintf]
   104 000000A2 83C40C                              add esp, 3 * 4
   105                                              
   106                                              not_printing:
   107 000000A5 EBAF                                jmp while_fscanf
   108                                          
   109                                          exit_while_fscanf:
   110                                          
   111                                          ;closing the files
   112                                          ;fclose(descriptor1)
   113 000000A7 FF35[16000000]                  push dword [descriptor1]
   114 000000AD FF15[00000000]                  call [fclose]
   115 000000B3 83C404                          add esp, 1 * 4
   116                                          
   117                                          ;fclose(descriptor2)
   118 000000B6 FF35[27000000]                  push dword [descriptor2]
   119 000000BC FF15[00000000]                  call [fclose]
   120 000000C2 83C404                          add esp, 1 * 4
   121                                          
   122                                          
   123 000000C5 6A00                            push    dword 0      
   124 000000C7 FF15[00000000]                  call    [exit]       
